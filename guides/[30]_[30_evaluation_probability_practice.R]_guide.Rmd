---
title: "[30] Probability practice exercises Guide"
output:
  md_document:
    variant: gfm
output_dir: ../workshops
knitr:
  opts_knit:
    root.dir: ..
---

This tutorial complements `30_evaluation_probability_practice.R` and unpacks the workshop on probability practice exercises. You will see how it advances the Evaluation sequence while building confidence with base R and tidyverse tooling.

## Setup

- Ensure you have opened the `archr` project root (or set your working directory there) before running any code.
- Open the workshop script in RStudio so you can execute lines interactively with `Ctrl+Enter` or `Cmd+Enter`.
- Create a fresh R session to avoid conflicts with leftover objects from earlier workshops.

## Skills

- Navigate the script `30_evaluation_probability_practice.R` within the Evaluation module.
- Connect the topic "Probability practice exercises" to systems architecting decisions.
- Load packages with `library()` and verify they attach without warnings.
- Chain tidyverse verbs with `%>%` to explore stakeholder or architecture tables.
- Iterate on visualisations built with `ggplot2`.

## Application

### Step 1 – Load Packages

Load required libraries. Attach dplyr to make its functions available.

```{r step_01, eval=FALSE}
library(dplyr)
library(readr)
library(ggplot2)
```

### Step 2 – Create `cost`

Import data! Cost distribution stats ($1000s) by subsystem.

```{r step_02, eval=FALSE}
cost = tribble(
  ~type, ~system, ~dist,    ~mu, ~sigma,
  "cost", "app",  "normal", 40,  2,
  "cost", "mak",  "exponential", 30,  NA,
  "cost", "dec",  "normal", 60,  4,
  "cost", "qc",  "poisson", 20,  NA,
  "cost", "del",  "normal", 80,  5
)
```

### Step 3 – Create `time`

Time distribution stats (hours) by subsystem.

```{r step_03, eval=FALSE}
time <- tribble(
  ~type, ~system, ~dist,        ~mu, ~sigma,
  "time", "app",  "normal",      500,   25,
  "time", "mak",  "exponential", 1500,  NA,
  "time", "dec",  "normal",      400,   25,
  "time", "qc",   "poisson",     1200,  NA,
  "time", "del",  "normal",      1300,  30
)
```

### Step 4 – Create `bench`

pnorm, pexp, ppois, etc. - cumulative distribution rnorm, rexp, rpois, etc. - simulates times dnorm, dexp, dpois, etc - value of pdf Set parameters.

```{r step_04, eval=FALSE}
bench <- 520 # suppose 520 hours is our firm deadline from funders
```

### Step 5 – Clear Objects

Eg. What % of cases would should we expect take > 520 hours? Assume a normal distribution.

```{r step_05, eval=FALSE}
1 - pnorm(bench, mean = 500, sd = 25)
```

### Step 6 – Clear Objects

100 random draws if normal.......

```{r step_06, eval=FALSE}
rnorm(n = 100, mean = 500, sd = 25)
```

### Step 7 – Create `o`

Create the object `o` so you can reuse it in later steps.

```{r step_07, eval=FALSE}
o <- tibble(
  app = rnorm(n = 1000, mean = 500, sd = 25),
  mak = rexp(n = 1000, rate = 1 / 1500),
  dec = rnorm(n = 1000, mean = 400, sd = 25),
  qc = rpois(n = 1000, lambda = 1200),
  del = rnorm(n = 1000, mean = 1300, sd = 30)
)
```

### Step 8 – Practice the Pipe

Use the `%>%` operator to pass each result to the next tidyverse verb.

```{r step_08, eval=FALSE}
o %>%
  mutate(id = 1:n()) %>%
  group_by(id) %>%
  mutate(max = max(c(app, mak, dec, qc, del)))
```

### Step 9 – Practice the Pipe

Use the `%>%` operator to pass each result to the next tidyverse verb.

```{r step_09, eval=FALSE}
o %>%
  rowwise() %>%
  mutate(max = max(c(app, mak, dec, qc, del)))
```

### Step 10 – Practice the Pipe

Use the `%>%` operator to pass each result to the next tidyverse verb.

```{r step_10, eval=FALSE}
o %>%
  rowwise() %>%
  mutate(sum = sum(c(app, mak, dec, qc, del)))
```

### Step 11 – Practice the Pipe

Use the `%>%` operator to pass each result to the next tidyverse verb.

```{r step_11, eval=FALSE}
o = o %>%
  rowwise() %>%
  mutate(max = max(c(app, mak, dec, qc, del))) %>%
  mutate(sum = sum(c(app, mak, dec, qc, del)))
```

### Step 12 – Run the Code Block

Execute the block and pay attention to the output it produces.

```{r step_12, eval=FALSE}
o
```

### Step 13 – Practice the Pipe

Get max. Use the `%>%` operator to pass each result to the next tidyverse verb.

```{r step_13, eval=FALSE}
o = o %>% 
  rowwise() %>%
  mutate(max = max(c(app, mak, dec, qc, del)))
```

### Step 14 – Practice the Pipe

Get total. Use the `%>%` operator to pass each result to the next tidyverse verb.

```{r step_14, eval=FALSE}
o = o %>% 
  rowwise() %>%
  mutate(sum = sum(c(app, mak, dec, qc, del)))
```

### Step 15 – Start a ggplot

2.3 Compute Quantities of Interest View the histogram / approximate the PDF!

```{r step_15, eval=FALSE}
ggplot(o, aes(x = sum)) +
  geom_histogram(binwidth = 100, fill = "green", color = "black") +
  labs(x = "System Completion Time (hours)", y = "Frequency")
```

### Step 16 – Start a ggplot

Initialize a ggplot so you can layer geoms and customise aesthetics.

```{r step_16, eval=FALSE}
ggplot(o, aes(x = max)) +
  geom_histogram(binwidth = 100, fill = "purple", color = "black") +
  labs(x = "Max Subsystem Completion Time (hours)", y = "Frequency")
```

### Step 17 – Run the Code Block

Compute the median, mean, and standard deviation of this distribution! "If simultaneously...

```{r step_17, eval=FALSE}
median(o$max)
mean(o$max)
sd(o$max)
```

### Step 18 – Run the Code Block

"If sequentially... Execute the block and pay attention to the output it produces.

```{r step_18, eval=FALSE}
median(o$sum)
mean(o$sum)
sd(o$sum)
```

### Step 19 – Run the Code Block

TASK 2: SIMULATE OVERALL SYSTEM Try your best to repeat this process, but this time, simulate the **TOTAL COST** of the system overall, using our table t above!

```{r step_19, eval=FALSE}
cost
```

### Step 20 – Create `k`

Create the object `k` so you can reuse it in later steps.

```{r step_20, eval=FALSE}
k = tibble(
  app = rnorm(n = 1000, mean = 40, sd = 2),
  mak = rexp(n = 1000, rate = 1 / 30),
  dec = rnorm(n = 1000, mean = 60, sd = 4),
  qc = rpois(n = 1000, lambda = 20),
  del = rnorm(n = 1000, mean = 80, sd = 5)
)
```

### Step 21 – Practice the Pipe

Use the `%>%` operator to pass each result to the next tidyverse verb.

```{r step_21, eval=FALSE}
k %>% 
  rowwise() %>% 
  mutate(sum = sum(c(app:del)))
```

### Step 22 – Practice the Pipe

If you need to do it without using specific values.

```{r step_22, eval=FALSE}
cost %>%
  group_by(system) %>%
  reframe(
    id = 1:n(),
    sim = case_when(
    dist == "normal" ~ rnorm(n = 1000, mean = mu, sd = sigma),
    dist == "exponential" ~ rexp(n = 1000, rate = 1 / mu),
    dist == "poisson" ~ rpois(n = 1000, lambda = mu)
  ))
```

### Step 23 – Create `p`

EXAMPLE 3: SIMULATING DISCRETE DISTRIBUTIONS Let's say in the Donut Cannon Subsystem, every cannon has the same reliability (p = 95%).

```{r step_23, eval=FALSE}
p <- 0.95
# If we have n donuts we want to launch...
n <- 10
# We can calculate using a binomial distribution PDF quantities of interest
```

### Step 24 – Run the Code Block

3.1 What's the probability that 9 out of 10 land successfully?

```{r step_24, eval=FALSE}
dbinom(9, size = n, prob = p)
```

### Step 25 – Run the Code Block

3.2 What's the probability that at least 9 land successfully?

```{r step_25, eval=FALSE}
pbinom(9, size = n, prob = p)
```

### Step 26 – Run the Code Block

more than 9. Execute the block and pay attention to the output it produces.

```{r step_26, eval=FALSE}
1 - pbinom(9, size = n, prob = p)
```

### Step 27 – Practice the Pipe

3.3 simulate 100 draws from a binomial distribution to determine the expected number of donuts.

```{r step_27, eval=FALSE}
rbinom(100, n, p) %>% mean()
rbinom(100, n, p) %>% sd()
```

## Learning Checks

**Learning Check 1.** How do you run the entire workshop script after you have stepped through each section interactively?

<details>
<summary>Show answer</summary>

Use `source(file.path("workshops", "30_evaluation_probability_practice.R"))` from the Console or press the Source button while the script is active.

</details>

**Learning Check 2.** Why does the script begin by installing or loading packages before exploring the exercises?

<details>
<summary>Show answer</summary>

Those commands make sure the required libraries are available so every subsequent code chunk runs without missing-function errors.

</details>

**Learning Check 3.** How does the `%>%` pipeline help you reason about multi-step transformations in this script?

<details>
<summary>Show answer</summary>

It keeps each operation in sequence without creating temporary variables, so you can narrate the data story line by line.

</details>

**Learning Check 4.** What experiment can you run on the `ggplot` layers to understand how aesthetics map to data?

<details>
<summary>Show answer</summary>

Switch one aesthetic (for example `color` to `fill` or tweak the geometry) and re-run the chunk to observe the difference.

</details>
