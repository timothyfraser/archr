---
title: "[08] Metric design walkthrough Guide"
output:
  md_document:
    variant: gfm
output_dir: ../workshops
knitr:
  opts_knit:
    root.dir: ..
---

This tutorial complements `08_architecting_metric_design.R` and unpacks the workshop on metric design walkthrough. You will see how it advances the Architecting Systems sequence while building confidence with base R and tidyverse tooling.

## Setup

- Ensure you have opened the `archr` project root (or set your working directory there) before running any code.
- Open the workshop script in RStudio so you can execute lines interactively with `Ctrl+Enter` or `Cmd+Enter`.
- Create a fresh R session to avoid conflicts with leftover objects from earlier workshops.

## Skills

- Navigate the script `08_architecting_metric_design.R` within the Architecting Systems module.
- Connect the topic "Metric design walkthrough" to systems architecting decisions.
- Load packages with `library()` and verify they attach without warnings.
- Chain tidyverse verbs with `%>%` to explore stakeholder or architecture tables.
- Define custom functions to package repeatable logic.

## Application

### Step 1 – Load Packages

Attach dplyr to make its functions available.

```{r step_01, eval=FALSE}
library(dplyr)
library(archr)
```

### Step 2 – Create `archs`

Create the object `archs` so you can reuse it in later steps.

```{r step_02, eval=FALSE}
archs = enumerate_binary(n = 5, .id = TRUE)
```

### Step 3 – Define `get_cost()`

Cost metric function. Create the helper function `get_cost()` so you can reuse it throughout the workshop.

```{r step_03, eval=FALSE}
get_cost = function(d1,d2,d3,d4,d5){
  m1 = case_when(d1 == 1 ~ 40, TRUE ~ 0)
  m2 = case_when(d2 == 1 ~ 750, TRUE ~ 0)
  m3 = case_when(d3 == 1 ~ 200, TRUE ~ 0)
  m4 = case_when(d4 == 1 ~ 500, TRUE ~ 0)
  m5 = case_when(d5 == 1 ~ 1000, TRUE ~ 0)
  output = m1+m2+m3+m4+m5
  return(output)
}
```

### Step 4 – Define `get_benefit()`

Benefit metric function. Create the helper function `get_benefit()` so you can reuse it throughout the workshop.

```{r step_04, eval=FALSE}
get_benefit = function(d1,d2,d3,d4,d5){
  # 10-point ordinal scale
  m1 = case_when(d1 == 1 ~ 3, TRUE ~ 2)
  m2 = case_when(d2 == 1 ~ 2, TRUE ~ 4)
  m3 = case_when(d3 == 1 ~ 5, TRUE ~ 7)
  m4 = case_when(d4 == 1 ~ 9, TRUE ~ 2)
  m5 = case_when(d5 == 1 ~ 5, TRUE ~ 3)
  output = m1+m2+m3+m4+m5
  return(output)
}
```

### Step 5 – Define `get_reliability()`

Reliability metric function. Create the helper function `get_reliability()` so you can reuse it throughout the workshop.

```{r step_05, eval=FALSE}
get_reliability = function(t = 100, d1,d2,d3,d4,d5){
  # Several ways to model a decision's impact on overall reliability...
  # Option 1:
  # If we adopt technology d1=1, the failure rate is 1/1000, so the reliability at time t will be...
  p1 = case_when(d1 == 1 ~ 1 - pexp(t, rate = 1/1000),
                 # If we DON'T adopt that technology, the OTHER technology has a failure rate of 1/10000
                 d1 == 0 ~ 1 - pexp(t, rate = 1/10000))
  # Option 2:
  p2 = case_when(
    # If we adopt tech d2=1....
    d2 == 1 ~ 1 - pexp(t, rate = 1/2000),
    # If we DON'T adopt tech d2=1, no tech to fail, so R=1
    TRUE ~ 1)
  p3 = case_when(d3 == 1 ~ 1 - pexp(t, rate = 1/15000), TRUE ~ 1)
  p4 = case_when(d4 == 1 ~ 1 - pexp(t, rate = 1/5000), TRUE ~ 1)
  # Option 3:
  # Maybe d5 has no relevance to operational risk.
  # p5 = case_when(d1 == 1 ~ 1 - pexp(t, rate = 1/500000), TRUE ~ 1)
  # Whether d5=1 or d5=0, reliability will still be 100%
  p5 = 1
```

### Step 6 – Create `output`

Create the object `output` so you can reuse it in later steps.

```{r step_06, eval=FALSE}
  output = p1*p2*p3*p4*p5
  return(output)
}
```

### Step 7 – Practice the Pipe

2. METRICS ###########################################################################. Use the `%>%` operator to pass each result to the next tidyverse verb.

```{r step_07, eval=FALSE}
archs = archs %>% mutate(cost = get_cost(d1,d2,d3,d4,d5))
archs = archs %>% mutate(benefit = get_benefit(d1,d2,d3,d4,d5))
archs = archs %>% mutate(reliability = get_reliability(t = 1000, d1,d2,d3,d4,d5))
```

## Learning Checks

**Learning Check 1.** How do you run the entire workshop script after you have stepped through each section interactively?

<details>
<summary>Show answer</summary>

Use `source(file.path("workshops", "08_architecting_metric_design.R"))` from the Console or press the Source button while the script is active.

</details>

**Learning Check 2.** Why does the script begin by installing or loading packages before exploring the exercises?

<details>
<summary>Show answer</summary>

Those commands make sure the required libraries are available so every subsequent code chunk runs without missing-function errors.

</details>

**Learning Check 3.** How does the `%>%` pipeline help you reason about multi-step transformations in this script?

<details>
<summary>Show answer</summary>

It keeps each operation in sequence without creating temporary variables, so you can narrate the data story line by line.

</details>

**Learning Check 4.** How can you build confidence that a newly defined function behaves as intended?

<details>
<summary>Show answer</summary>

Call it with the sample input from the script, examine the output, then try a new input to see how the behaviour changes.

</details>
